
# 📺 电视剧精彩片段专业剪辑系统 - 使用指南

## 🎯 系统概述

本系统基于您制定的专业剪辑规则，实现电视剧字幕分析和视频自动剪辑：

### 核心剪辑规则
- **单集核心聚焦**：每集围绕1个核心剧情点，时长2-3分钟
- **主线剧情优先**：突出四二八案、628旧案、听证会辩论
- **强戏剧张力**：证词反转、法律争议、情感爆发点
- **跨集连贯性**：保持故事线逻辑一致，明确衔接点

## 🚀 快速开始

### 1. 运行主程序
```bash
python3 main.py
```

### 2. 选择操作模式
- **选项1**：仅字幕分析（生成剪辑方案）
- **选项2**：完整剪辑流程（分析+视频剪辑）

## 📁 文件结构要求

```
项目文件夹/
├── main.py                    # 主程序
├── subtitle_analyzer.py       # 字幕分析模块
├── video_clipper.py          # 视频剪辑模块
├── S01E01_4K_60fps.txt       # 字幕文件（必需）
├── S01E02_4K_60fps.txt
├── ...
├── videos/                    # 视频文件夹
│   ├── S01E01_4K_60fps.mp4   # 对应视频文件
│   ├── S01E02_4K_60fps.mp4
│   └── ...
└── professional_clips/       # 输出文件夹（自动创建）
    ├── E01_案件调查.mp4
    ├── E02_听证会辩论.mp4
    └── Complete_Series_Professional_Highlights.mp4
```

## 📝 字幕分析功能

### 分析算法
系统会自动识别：
- **主线剧情关键词**：四二八案、628旧案、正当防卫、听证会等
- **戏剧张力标识**：反转、揭露、发现、震惊等
- **情感爆发点**：愤怒、痛苦、激动、崩溃等
- **对话强度**：感叹号、问号、省略号等

### 错别字修正
自动修正常见错别字：
- 防衛 → 防卫
- 正當 → 正当
- 証據 → 证据
- 檢察官 → 检察官

### 输出方案格式
每集包含：
```
📺 E07：李慕枫申诉启动，旧案疑点浮现
----------------------------------------
总时长：142.3 秒 (2.4 分钟)
片段数：1 个核心片段

🎬 片段 1：
   时间片段：00:15:23,450 --> 00:18:05,780
   时长：162.3 秒
   剧情意义：核心案件进展、关键证据揭露
   核心内容：四二八案申诉程序启动 | 628旧案证据浮现...
   
   关键台词（标注字幕中的精确时间）：
     [00:15:45,230 --> 00:15:48,660] 我要为四二八案申请重审
     [00:16:12,440 --> 00:16:15,320] 这个证据证明当年的判决有误

✨ 本集亮点：
   • 核心案件进展：四二八案申诉程序启动... (申诉程序启动，为翻案奠定基础)

🔗 与下一集衔接：本集申诉启动，为下一集听证会翻案铺垫
```

## 🎬 视频剪辑功能

### 剪辑特性
- **精确时间码**：使用字幕文件的精确时间戳
- **缓冲处理**：前后各增加2秒缓冲，避免断句
- **高质量输出**：使用H.264编码，CRF 18-22质量
- **专业标题**：自动添加集数标题和剧情说明

### 合并策略
- 单集内片段：平滑过渡合并
- 跨集连贯性：保持逻辑顺序
- 完整集锦：生成全剧精彩合集

## ⚙️ 技术要求

### 必需软件
- **Python 3.6+**
- **FFmpeg**（用于视频剪辑）

### FFmpeg安装
```bash
# Ubuntu/Debian
sudo apt install ffmpeg

# macOS
brew install ffmpeg

# Windows
# 从 https://ffmpeg.org 下载并添加到PATH
```

### Python依赖
```bash
pip3 install flask  # 如需Web界面
```

## 🔧 高级配置

### 调整剪辑参数
在 `subtitle_analyzer.py` 中修改：
```python
# 最低精彩度分数
if score >= 5.0:  # 调整此值改变筛选严格度

# 片段时长控制
if 120 <= duration <= 180:  # 调整时长范围（秒）
```

### 自定义关键词
```python
# 添加特定关键词
self.main_plot_keywords.extend(['自定义关键词1', '关键词2'])
```

## 📊 输出文件说明

### 分析报告
- `professional_editing_plan.txt`：详细剪辑方案
- 包含每集的精确时间码、剧情意义、衔接说明

### 视频文件
- `E01_主题描述.mp4`：单集剪辑版本
- `Complete_Series_Professional_Highlights.mp4`：完整剧集精彩集锦

## 🔍 故障排除

### 常见问题

1. **找不到视频文件**
   - 检查videos文件夹是否存在
   - 确认视频文件名与字幕文件名匹配

2. **FFmpeg错误**
   - 确认FFmpeg已正确安装
   - 检查视频文件格式是否支持

3. **字幕解析失败**
   - 检查字幕文件编码（应为UTF-8）
   - 确认字幕格式为标准SRT格式

4. **分析结果为空**
   - 调低筛选分数阈值
   - 检查关键词是否匹配剧情内容

### 调试模式
运行时如遇问题，检查：
```bash
python3 main.py
# 选择"3. 查看系统状态"查看详细信息
```

## 📞 技术支持

如需调整剪辑规则或添加新功能，可以修改：
- `subtitle_analyzer.py`：分析算法和关键词
- `video_clipper.py`：剪辑参数和输出格式
- `main.py`：工作流程和用户界面

系统完全按照您制定的专业剪辑规则设计，确保输出的短视频具有完整的故事线和强烈的戏剧张力。
