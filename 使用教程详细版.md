
# 智能电视剧剪辑系统 - 详细使用教程

## 📖 系统概述

智能电视剧剪辑系统是一个基于AI技术的自动化视频剪辑工具，能够：
- 🤖 智能分析电视剧字幕内容
- 🎯 自动识别精彩片段
- ✂️ 自动剪辑生成短视频
- 📝 生成专业旁白解说
- 🔄 支持批量处理多集

## 🚀 快速开始

### 1. 目录结构准备

在项目根目录下创建以下文件夹结构：

```
项目根目录/
├── srt/              # 字幕文件目录
│   ├── 第01集.srt
│   ├── 第02集.srt
│   └── ...
├── videos/           # 视频文件目录
│   ├── 第01集.mp4
│   ├── 第02集.mp4
│   └── ...
├── clips/            # 输出目录（自动创建）
└── cache/            # 缓存目录（自动创建）
```

### 2. 文件命名规则

**重要：** 字幕文件名决定了电视剧的集数顺序，系统按文件名字符串排序处理。

✅ **推荐命名方式：**
- `第01集.srt` / `第01集.mp4`
- `EP01.srt` / `EP01.mp4`
- `S01E01.srt` / `S01E01.mp4`

❌ **避免的命名方式：**
- `1.srt` / `2.srt` (排序会出问题)
- 包含特殊字符的文件名

### 3. 运行系统

在终端中运行：
```bash
python clean_main.py
```

系统启动后会显示主菜单界面。

## 🤖 AI配置详解

### 配置选项说明

系统支持两种AI接口类型：

#### 1. 官方API (api_type: 'official')
- **特点：** 直接连接官方服务，无需base_url
- **支持：** Google Gemini
- **配置示例：**
  ```json
  {
    "enabled": true,
    "api_type": "official",
    "provider": "gemini",
    "api_key": "你的Gemini API密钥",
    "model": "gemini-2.5-flash"
  }
  ```

#### 2. 中转API (api_type: 'proxy')
- **特点：** 通过中转服务访问，需要base_url
- **支持：** ChatAI、OpenRouter等中转服务
- **配置示例：**
  ```json
  {
    "enabled": true,
    "api_type": "proxy",
    "provider": "proxy",
    "base_url": "https://www.chataiapi.com/v1",
    "api_key": "sk-CU2KOpYc3LK5",
    "model": "deepseek-r1"
  }
  ```

### 获取API密钥

#### Google Gemini API
1. 访问：https://ai.google.dev/
2. 注册并创建项目
3. 获取API密钥
4. 安装依赖：`pip install google-genai`

#### ChatAI API
1. 访问：https://www.chataiapi.com/
2. 注册账户并充值
3. 获取API密钥
4. 支持多种模型：GPT-4、Claude、DeepSeek等

### 配置步骤

1. 启动系统后选择"1. 🤖 配置AI接口"
2. 选择API类型：
   - 选择"1"配置官方API（Gemini）
   - 选择"2"配置中转API
3. 按提示输入相关信息
4. 系统会自动测试连接
5. 配置成功后会保存到`.ai_config.json`文件

## 🎬 剪辑流程详解

### 1. 字幕解析

系统会：
- 自动检测字幕文件编码（UTF-8、GBK、UTF-16）
- 解析SRT格式时间戳和文本内容
- 处理常见的格式错误

### 2. AI智能分析

AI分析过程：
1. **上下文构建：** 将整集字幕分段组织，保持上下文连贯
2. **智能识别：** 自动识别剧情类型（悬疑、爱情、职场等）
3. **片段选择：** 找出3-5个最精彩的2-3分钟片段
4. **内容生成：** 为每个片段生成标题、描述和旁白

### 3. 视频剪辑

剪辑特点：
- 使用FFmpeg进行高质量剪辑
- 自动优化视频参数（H.264编码，AAC音频）
- 智能避免截断对话（在完整句子处切分）
- 支持断点续传（已存在的片段不重复剪辑）

### 4. 缓存机制

系统会：
- 自动保存AI分析结果到`cache/`目录
- 避免重复分析相同内容
- 支持多次运行保持一致性

## 📁 输出文件说明

### 视频片段文件
- **位置：** `clips/`目录
- **命名：** `{片段标题}_seg{ID}.mp4`
- **特点：** H.264编码，优化的质量设置

### 旁白文件
- **位置：** `clips/`目录
- **命名：** `{片段标题}_seg{ID}_旁白.txt`
- **内容：**
  - 片段基本信息
  - AI生成的专业解说词
  - 观看提示和内容摘要

### 字幕文件
- **位置：** `clips/`目录
- **命名：** `{片段标题}_seg{ID}_字幕.srt`
- **用途：** 可用于视频播放时的额外字幕显示

## ⚡ 使用技巧

### 1. 提高分析质量
- 确保字幕内容完整准确
- 避免字幕中有大量错别字
- 单集字幕建议不少于500条

### 2. 优化剪辑效果
- 视频文件建议使用常见格式（MP4、MKV）
- 确保视频和字幕时间轴对齐
- 视频质量建议720P以上

### 3. 提升处理效率
- 首次运行会生成缓存，后续运行更快
- 可以分批处理，系统支持断点续传
- 定期清理`clips/`目录避免空间不足

## 🔧 故障排除

### 常见问题

#### 1. AI分析失败
**可能原因：**
- API密钥无效或过期
- 网络连接问题
- 字幕内容过少

**解决方法：**
- 重新配置AI接口
- 检查网络连接
- 确保字幕文件完整

#### 2. 视频剪辑失败
**可能原因：**
- FFmpeg未安装
- 视频文件损坏
- 磁盘空间不足

**解决方法：**
- 安装FFmpeg：`apt install ffmpeg`
- 检查视频文件完整性
- 清理磁盘空间

#### 3. 文件匹配失败
**可能原因：**
- 字幕和视频文件名不匹配
- 文件格式不支持

**解决方法：**
- 确保文件名一致（除扩展名外）
- 使用支持的格式（.srt, .mp4, .mkv等）

### 日志信息说明

- `✅` 表示操作成功
- `⚠️` 表示警告（可能影响结果）
- `❌` 表示错误（需要处理）
- `💾` 表示使用了缓存
- `🎬` 表示剪辑操作

## 📊 系统架构

### 核心模块

1. **配置管理模块**
   - AI接口配置
   - 连接测试
   - 配置保存/加载

2. **字幕解析模块**
   - 多编码支持
   - SRT格式解析
   - 错误处理

3. **AI分析模块**
   - 官方API调用
   - 中转API调用
   - 结果解析

4. **视频处理模块**
   - FFmpeg集成
   - 片段剪辑
   - 质量优化

5. **缓存管理模块**
   - 分析结果缓存
   - 一致性保证
   - 自动清理

### 数据流程

```
SRT字幕文件 → 解析器 → AI分析 → 片段信息 → 视频剪辑 → 输出文件
     ↓           ↓        ↓         ↓         ↓
   编码检测   时间解析   智能识别   FFmpeg   旁白生成
     ↓           ↓        ↓         ↓         ↓
   内容提取   上下文构建  片段选择   质量优化   SRT字幕
```

## 🎯 最佳实践

### 1. 批量处理建议
- 按季度或故事弧线分组处理
- 预留足够的磁盘空间
- 在非高峰时段运行（减少API限制）

### 2. 质量控制
- 定期检查输出质量
- 根据剧情类型调整AI提示词
- 保留原始文件备份

### 3. 成本优化
- 使用缓存避免重复分析
- 选择性处理重要集数
- 合理选择AI模型（成本vs质量）

## 📈 进阶功能

### 自定义配置

可以通过修改系统参数来优化效果：

1. **片段时长控制**
   - 默认：2-3分钟
   - 可调整为1-5分钟

2. **质量设置**
   - 视频编码：H.264
   - 音频编码：AAC
   - CRF值：23（可调整）

3. **AI提示词优化**
   - 根据剧情类型定制
   - 调整片段选择标准
   - 优化旁白风格

### 扩展开发

系统采用模块化设计，支持：
- 添加新的AI接口
- 集成其他视频格式
- 自定义分析算法
- 扩展输出格式

## 🆘 技术支持

### 系统要求
- Python 3.7+
- FFmpeg
- 网络连接（用于AI API）
- 足够的磁盘空间

### 依赖包
- `openai` - OpenAI兼容API调用
- `google-genai` - Google Gemini API
- 系统自动安装其他依赖

### 获取帮助
- 查看控制台输出的详细错误信息
- 检查`.ai_config.json`配置文件
- 确认`cache/`目录权限正常

---

**版本信息：** v3.0  
**更新时间：** 2024年1月  
**兼容性：** 支持主流操作系统
