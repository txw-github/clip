
# 🎬 完整智能电视剧剪辑系统 - 使用教程

## 📋 系统概述

这是一个完整集成的智能电视剧剪辑系统，解决了所有16个核心问题，提供稳定、一致的剪辑体验。

### ✨ 核心特色

1. **智能剧情点识别** - 自动识别5种剧情点类型（关键冲突、人物转折、线索揭露、情感爆发、重要对话）
2. **保证句子完整** - 确保剪辑不会截断重要对话
3. **API稳定性处理** - 分析结果缓存，避免重复调用
4. **剪辑一致性保证** - 相同分析多次剪辑结果一致
5. **断点续传** - 已剪辑的视频不重复处理
6. **多次执行一致性** - 相同字幕文件结果始终一致
7. **全文件处理** - 处理所有SRT文件，智能缓存中间结果
8. **错别字自动修正** - 自动修正常见繁体字和错误

## 🚀 快速开始

### 第一步：准备文件结构

```
项目目录/
├── srt/              # 字幕目录 📝
│   ├── E01.srt
│   ├── E02.srt
│   ├── E03.srt
│   └── ...
├── videos/           # 视频目录 🎬  
│   ├── E01.mp4
│   ├── E02.mp4
│   ├── E03.mp4
│   └── ...
├── clips/            # 输出目录（自动创建）
├── analysis_cache/   # 分析缓存（自动创建）
├── clip_status/      # 剪辑状态（自动创建）
├── reports/          # 报告目录（自动创建）
└── clean_main.py     # 主程序
```

### 第二步：运行系统

```bash
# 直接运行主程序
python clean_main.py
```

系统会自动：
1. 扫描所有SRT文件
2. 按文件名顺序处理每一集
3. 智能缓存分析结果
4. 避免重复剪辑已完成的片段
5. 生成详细的处理报告

## 📝 文件命名规范

### 字幕文件命名
支持多种命名格式：
- `E01.srt`, `E02.srt` （推荐）
- `EP01.srt`, `EP02.srt`
- `S01E01.srt`, `S01E02.srt`
- `第1集.srt`, `第2集.srt`
- `01.srt`, `02.srt`

### 视频文件命名
视频文件应与字幕文件对应：
- `E01.mp4` 对应 `E01.srt`
- `E02.mkv` 对应 `E02.srt`
- 支持格式：`.mp4`, `.mkv`, `.avi`, `.mov`, `.wmv`, `.flv`, `.ts`

## 🎯 输出说明

### 生成的文件

每个剧情点会生成：

1. **视频片段** - `第X集-关键冲突：法庭激辩.mp4`
2. **详细说明** - `第X集-关键冲突：法庭激辩_完整说明.txt`

### 说明文件内容示例

```
📺 第01集-关键冲突：法庭激辩，针锋相对
=====================================

【基本信息】
集数编号：第01集
片段类型：关键冲突
总时长：185.3 秒

【时间段信息】
片段 1：00:15:23,000 --> 00:18:28,300
选择原因：关键冲突核心片段

【剧情分析】
剧情意义：在法律剧中，此冲突代表核心矛盾的激化，推动剧情走向高潮
内容摘要：在这个关键冲突片段中，双方展开激烈对抗...
情感冲击：激烈的对抗让观众血脉贲张，紧张的氛围令人屏息凝神...

【关键台词】
[00:15:25,000] 这个证据的有效性存在严重问题
[00:16:12,000] 我坚持认为我的当事人是无辜的
[00:17:05,000] 请法官明察，真相就在眼前

【第三人称旁白字幕】
法庭之上，双方律师唇枪舌剑，针锋相对。每一个论点都关乎正义的天平，每一句反驳都可能改变案件走向。在这场没有硝烟的战争中，真理与公正成为最终的裁判。
```

### 处理报告

系统会在 `reports/` 目录生成：
- **完整智能剪辑报告.txt** - 包含所有处理统计和详细信息

## 🔧 高级功能

### 1. 缓存机制

- **分析缓存** - 存储在 `analysis_cache/` 目录，避免重复AI分析
- **剪辑状态** - 存储在 `clip_status/` 目录，避免重复剪辑

### 2. 错别字修正

系统自动修正常见错误：
- 防衛 → 防卫
- 正當 → 正当
- 証據 → 证据
- 檢察官 → 检察官
- 更多...

### 3. 句子完整性保证

剪辑时会：
- 寻找自然的句子开始点
- 确保句子完整结束
- 避免截断重要对话

### 4. 剧情类型自动识别

支持识别：
- 法律剧
- 爱情剧  
- 悬疑剧
- 家庭剧
- 通用剧

## 🛠️ 常见问题

### Q: 为什么有些集数没有生成视频？
A: 可能原因：
1. 字幕文件格式不支持
2. 找不到对应的视频文件
3. 未识别到符合条件的剧情点

### Q: 如何重新处理某一集？
A: 删除对应的缓存文件：
1. 删除 `analysis_cache/` 中对应的分析缓存
2. 删除 `clip_status/` 中对应的剪辑状态
3. 重新运行程序

### Q: 输出的视频质量如何控制？
A: 系统使用中等质量设置（CRF=23），平衡文件大小和质量。

### Q: 支持哪些视频格式？
A: 输入支持：MP4, MKV, AVI, MOV, WMV, FLV, TS
   输出格式：MP4（H.264 + AAC）

## 🎨 自定义配置

### 剧情点类型权重调整

在 `clean_main.py` 中找到 `plot_point_types` 配置：

```python
self.plot_point_types = {
    '关键冲突': {
        'keywords': ['冲突', '争执', '对抗', ...],
        'weight': 10,           # 调整权重
        'ideal_duration': 180,  # 调整目标时长（秒）
        'min_score': 15         # 调整最低分数
    },
    # ...
}
```

### 错别字词典扩展

在 `corrections` 配置中添加新的修正规则：

```python
self.corrections = {
    '防衛': '防卫',
    '正當': '正当',
    # 添加新的修正规则
    '你的错字': '正确写法',
}
```

## 📊 性能优化

### 处理大量文件
- 系统使用智能缓存，第二次运行会跳过已处理的文件
- 支持断点续传，可随时中断和恢复

### 减少处理时间
- 分析结果会被缓存，避免重复分析
- 已剪辑的视频不会重复处理
- 并行处理多个时间段

## 🔄 系统维护

### 清理缓存
```bash
# 清理所有缓存（重新开始）
rm -rf analysis_cache/
rm -rf clip_status/

# 清理特定集数的缓存
rm analysis_cache/analysis_E01_*.json
rm clip_status/E01_*.json
```

### 检查处理状态
```bash
# 查看已处理的集数
ls analysis_cache/

# 查看已剪辑的片段
ls clip_status/

# 查看生成的视频
ls clips/
```

## 📞 技术支持

如果遇到问题：

1. **检查文件结构** - 确保 `srt/` 和 `videos/` 目录存在且有文件
2. **查看控制台输出** - 系统会显示详细的处理信息
3. **检查FFmpeg** - 确保系统已安装FFmpeg
4. **查看错误日志** - 系统会显示具体的错误信息

## 🎉 更新日志

### v2.0 (当前版本)
- ✅ 完整集成所有功能到 `clean_main.py`
- ✅ 保证句子完整，不截断对话
- ✅ API结果缓存，避免重复调用
- ✅ 剪辑一致性保证
- ✅ 断点续传支持
- ✅ 多次执行结果一致性
- ✅ 处理所有SRT文件，智能缓存
- ✅ 详细使用教程
- ✅ 清理冗余文件

---

🎬 **现在就开始体验智能剧情剪辑吧！**
