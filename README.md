
# 📺 电视剧精彩片段剪辑工具

这个工具可以自动分析电视剧字幕文件，识别精彩片段，并提供视频剪辑功能。

## 🚀 功能特性

- 📝 **智能字幕分析**: 自动识别包含关键词、强烈情绪的精彩对话
- 🎯 **精彩度评分**: 基于多维度算法为每个片段打分
- ✂️ **自动视频剪辑**: 使用FFmpeg精确剪切视频片段
- 🌐 **Web界面**: 直观的网页界面，方便管理和预览
- 🎬 **精彩集锦**: 将多个片段合并成一个精彩集锦视频

## 📋 准备工作

### 1. 文件结构
确保您的文件按以下结构组织：
```
项目文件夹/
├── S01E01_4K_60fps.txt  # 字幕文件
├── S01E02_4K_60fps.txt
├── ...
├── videos/              # 视频文件夹
│   ├── S01E01_4K_60fps.mp4
│   ├── S01E02_4K_60fps.mp4
│   └── ...
└── clips/               # 输出文件夹（自动创建）
```

### 2. 安装依赖

#### Python依赖
```bash
pip install flask
```

#### FFmpeg（用于视频剪辑）
- **Ubuntu/Debian**: `sudo apt install ffmpeg`
- **macOS**: `brew install ffmpeg`
- **Windows**: 从 [FFmpeg官网](https://ffmpeg.org) 下载并添加到PATH

## 🔧 使用方法

### 方法1: 命令行分析
```bash
# 分析字幕并输出精彩片段列表
python subtitle_analyzer.py

# 分析字幕并自动剪辑视频
python video_clipper.py
```

### 方法2: Web界面（推荐）
```bash
# 启动Web服务
python web_interface.py
```

然后打开浏览器访问 `http://localhost:5000`

## 🎛️ 参数调整

### 精彩度评分算法
您可以在 `subtitle_analyzer.py` 中调整以下参数：

```python
# 关键词权重
exciting_keywords = [
    '杀人', '死了', '救命', '不要', '完了', '危险',
    '检察官', '法官', '审判', '证据', '正当防卫',
    '真相', '秘密', '发现', '不可能', '为什么'
]

# 最低精彩度分数阈值
min_score = 3.0

# 最大剪辑片段数量
max_clips = 20
```

### 剪辑时间调整
```python
# 扩展时间范围（秒）
extended_start = max(0, start_seconds - 5)  # 前5秒
extended_end = end_seconds + 5              # 后5秒
```

## 📊 输出文件

- `exciting_clips.txt`: 精彩片段分析报告
- `clips/`: 剪辑的视频片段文件夹
- `drama_highlights.mp4`: 合并的精彩集锦

## 🎯 精彩片段识别逻辑

1. **关键词匹配**: 识别包含重要剧情关键词的对话
2. **情绪强度**: 检测感叹号、问号等情绪标记
3. **对话长度**: 适中长度的对话通常更重要
4. **上下文分析**: 考虑前后字幕的重要性
5. **数字信息**: 包含具体数字的对话往往重要

## ⚙️ 故障排除

### 常见问题

1. **找不到视频文件**
   - 确保视频文件名与字幕文件名匹配
   - 检查视频文件是否在 `videos/` 文件夹中

2. **FFmpeg错误**
   - 确保FFmpeg已正确安装
   - 检查视频文件格式是否支持

3. **字幕解析失败**
   - 检查字幕文件编码（应为UTF-8）
   - 确认字幕文件格式正确

### 性能优化

- 大文件处理时，可以调整 `max_clips` 参数减少处理量
- 使用SSD硬盘可以显著提高剪辑速度
- 如果内存不足，可以分批处理视频文件

## 📝 自定义关键词

您可以根据电视剧内容添加特定的关键词：

```python
# 法庭剧关键词
legal_keywords = ['法官', '律师', '证人', '辩护', '起诉']

# 悬疑剧关键词  
suspense_keywords = ['凶手', '线索', '真相', '秘密', '发现']

# 情感剧关键词
emotion_keywords = ['爱情', '分手', '结婚', '家庭', '亲情']
```

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个工具！

## 📄 许可证

MIT License - 详见LICENSE文件
