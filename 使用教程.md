# 🎬 智能电视剧剪辑系统 - 使用教程

## 🚀 快速开始

### 1. 准备文件
```
项目目录/
├── srt/              # 字幕文件目录
│   ├── EP01.srt
│   ├── EP02.srt
│   └── ...
├── videos/           # 视频文件目录
│   ├── EP01.mp4
│   ├── EP02.mp4
│   └── ...
└── clips/            # 输出目录 (自动创建)
```

### 2. 运行系统
点击绿色的 **Run** 按钮，或运行：
```bash
python main.py
```

### 3. 配置AI接口 (推荐)
- 选择 "1. 🤖 配置AI接口"
- 推荐使用代理API (ChatAI, OpenRouter等)
- 输入API地址、密钥和模型名称

### 4. 开始剪辑
- 选择 "2. 🎬 开始智能剪辑"
- 系统会自动处理所有字幕文件
- 每集生成3-5个精彩短视频

## 🎯 主要功能

| 功能 | 说明 |
|------|------|
| 🤖 AI智能分析 | 自适应识别剧情类型，找出精彩片段 |
| 🎬 自动剪辑 | 生成2-3分钟短视频 + 专业旁白 |
| 💾 智能缓存 | 避免重复分析，节省API调用 |
| 🔗 剧情连贯 | 保证跨集剧情逻辑一致 |
| 📝 旁白解说 | 自动生成专业解说文件 |

## 📁 输出文件

每个短视频会生成3个文件：
- `片段标题_seg1.mp4` - 视频文件
- `片段标题_seg1_旁白解说.txt` - 专业旁白
- `片段标题_seg1_旁白字幕.srt` - 字幕文件

## 💡 使用技巧

1. **文件命名**: 字幕和视频文件名要对应 (如 EP01.srt ↔ EP01.mp4)
2. **集数顺序**: 按文件名字符串排序处理
3. **AI配置**: 强烈建议配置AI接口以获得最佳效果
4. **断点续传**: 已处理的文件会自动跳过
5. **多次运行**: 相同输入保证相同输出

## 🛠️ 系统要求

- Python 3.7+
- FFmpeg (视频处理)
- 网络连接 (AI分析)

## 🔧 故障排除

### 常见问题
1. **找不到FFmpeg**: 确保已安装FFmpeg
2. **AI连接失败**: 检查API配置和网络
3. **视频匹配失败**: 确保文件名对应
4. **字幕解析失败**: 检查字幕文件格式

### 获取帮助
在主菜单选择对应功能：
- "3. 📁 查看详细文件状态" - 检查文件
- "4. 📖 查看使用教程" - 查看帮助
- "5. 🔍 测试AI连接" - 测试API

---

**🎉 开始您的智能剪辑之旅！**
# 智能AI电视剧剪辑系统 - 完整使用教程

## 📖 系统简介

这是一个基于AI的智能电视剧剪辑系统，能够：
- 自动分析字幕内容，识别精彩片段
- 智能剪辑视频，生成短视频片段
- 生成专业的旁白解说文件
- 支持官方API和中转API两种AI接口

## 🚀 快速开始

### 1. 目录结构
```
项目根目录/
├── main.py                 # 主程序
├── api_config_helper.py     # API配置助手
├── .ai_config.json         # AI配置文件（自动生成）
├── srt/                    # 字幕目录（手动创建并放入字幕文件）
├── videos/                 # 视频目录（手动创建并放入视频文件）
├── clips/                  # 输出目录（自动创建）
└── analysis_cache/         # 分析缓存（自动创建）
```

### 2. 准备文件
1. 创建 `srt/` 目录，放入字幕文件（.srt 或 .txt 格式）
2. 创建 `videos/` 目录，放入对应的视频文件（.mp4, .mkv, .avi等）
3. 确保字幕文件名和视频文件名对应（如：EP01.srt 对应 EP01.mp4）

### 3. 启动系统
```bash
python main.py
```

## 🤖 AI接口配置

系统支持两种API类型：

### 官方API（推荐：Google Gemini）
- **特点**：直接使用官方SDK，无需base_url
- **支持模型**：gemini-2.5-flash、gemini-2.5-pro
- **配置**：只需API密钥

**Gemini API获取方式**：
1. 访问 [Google AI Studio](https://aistudio.google.com/)
2. 注册并获取API密钥
3. 在系统中选择"官方API" -> "Google Gemini"
4. 输入API密钥即可

### 中转API
- **特点**：通过中转服务访问多种模型，使用OpenAI兼容格式
- **支持服务**：ChatAI、OpenRouter等
- **配置**：需要base_url和API密钥

**ChatAI配置示例**：
- API地址：`https://www.chataiapi.com/v1`
- 支持模型：deepseek-r1、claude-3-5-sonnet-20240620、gpt-4o等

## 📝 字幕文件要求

### 支持格式
- .srt 标准字幕格式
- .txt 文本格式（需要包含时间轴）

### 命名规则
- 字幕文件名决定处理顺序（按字符串排序）
- 推荐命名：EP01.srt、EP02.srt、第01集.srt等
- 系统会使用srt文件名作为集数标识

### 字幕格式示例
```
1
00:00:01,000 --> 00:00:05,000
这是第一条字幕

2
00:00:05,000 --> 00:00:10,000
这是第二条字幕
```

## 🎬 视频文件要求

### 支持格式
- .mp4（推荐）
- .mkv
- .avi
- .mov
- .wmv
- .flv

### 命名匹配
系统会自动匹配字幕和视频文件：
1. **精确匹配**：EP01.srt → EP01.mp4
2. **模糊匹配**：如果精确匹配失败，会搜索包含相同关键词的视频文件

## 🎯 系统功能详解

### 1. AI分析功能
- **剧情分析**：识别剧情类型、核心主题
- **片段识别**：找出3-5个最精彩的片段
- **时长控制**：每个片段2-3分钟
- **质量保证**：优先选择戏剧冲突强烈、情感张力大的场景

### 2. 智能剪辑功能
- **自动剪辑**：根据AI分析结果自动剪辑视频
- **格式优化**：输出高质量MP4格式
- **避免重复**：已剪辑的片段不会重复处理
- **断点续传**：支持中断后继续处理

### 3. 旁白生成功能
- **专业解说**：为每个片段生成专业的旁白解说
- **观看提示**：提供观众关注的精彩点提示
- **内容摘要**：生成片段内容概括

### 4. 缓存机制
- **分析缓存**：AI分析结果会被缓存，避免重复分析
- **一致性保证**：多次执行相同字幕文件结果一致
- **性能优化**：大幅提升处理速度

## 📊 输出文件说明

### 视频片段
- **位置**：`clips/` 目录
- **命名**：`{片段标题}_seg{序号}.mp4`
- **格式**：H.264编码的MP4文件

### 旁白文件
- **位置**：与视频片段同目录
- **命名**：`{片段名}_旁白解说.txt`
- **内容**：包含片段信息、专业旁白、观看提示等

### 分析缓存
- **位置**：`analysis_cache/` 目录
- **命名**：`{集数名}_{内容哈希}.json`
- **作用**：存储AI分析结果，提升处理效率

## 🔧 故障排除

### 常见问题

1. **AI连接失败**
   - 检查网络连接
   - 验证API密钥是否正确
   - 确认服务商状态是否正常

2. **字幕解析失败**
   - 检查字幕文件编码（支持UTF-8、GBK、UTF-16）
   - 确认字幕格式是否正确
   - 检查时间轴格式是否标准

3. **视频剪辑失败**
   - 确认已安装FFmpeg
   - 检查视频文件是否损坏
   - 验证时间轴是否在视频范围内

4. **找不到视频文件**
   - 检查视频文件是否在`videos/`目录
   - 确认文件名是否与字幕文件对应
   - 验证视频文件格式是否支持

### 依赖安装

系统会自动安装所需依赖，如果遇到问题可手动安装：

```bash
# 安装Python依赖
pip install openai google-generativeai

# 安装FFmpeg（Linux/Mac）
# Ubuntu/Debian
sudo apt update && sudo apt install ffmpeg

# CentOS/RHEL
sudo yum install epel-release && sudo yum install ffmpeg

# macOS
brew install ffmpeg
```

## 📈 性能优化建议

### 1. 硬件要求
- **CPU**：建议4核心以上
- **内存**：建议8GB以上
- **存储**：SSD硬盘，剩余空间至少是视频文件大小的2倍

### 2. 配置优化
- 使用官方API可获得更稳定的分析结果
- 选择合适的AI模型（速度vs质量平衡）
- 合理利用缓存机制避免重复分析

### 3. 批处理建议
- 一次处理多集时，建议分批进行
- 监控系统资源使用情况
- 定期清理临时文件和缓存

## 🆘 技术支持

### 配置文件位置
- AI配置：`.ai_config.json`
- 分析缓存：`analysis_cache/` 目录

### 日志信息
系统运行时会显示详细的处理日志，包括：
- 文件解析状态
- AI分析进度
- 剪辑处理结果
- 错误信息和解决建议

### 配置重置
如需重置AI配置，删除`.ai_config.json`文件重新配置即可。

---

📞 如有问题，请检查控制台输出的错误信息，大多数问题都有相应的解决提示。
