` tags, overwriting the original file.

```xml
<replit_final_file>
# 🎬 智能电视剧剪辑系统 v3.0 - 完整使用教程

## 🎯 系统概述

这是一个完全智能化的电视剧剪辑系统，解决了您提出的所有15个核心问题：

### ✨ 核心特性
- **完全AI智能分析** - 自动识别各种剧情类型，不限制特定剧情
- **整集上下文分析** - 避免台词割裂，保持剧情完整性
- **每集多个精彩短视频** - AI智能判断最适合的完整内容
- **实际剪辑生成** - 自动创建视频文件和专业旁白解说
- **智能缓存机制** - 避免重复API调用，支持断点续传
- **跨集剧情连贯** - 保证所有短视频能完整叙述整个剧情

## 📁 文件准备

### 1. 目录结构
系统会自动创建以下目录结构：
```
项目根目录/
├── srt/              # 字幕文件目录
├── videos/           # 视频文件目录  
├── clips/            # 输出的短视频目录
├── cache/            # AI分析缓存目录
├── main.py           # 主程序
└── .ai_config.json   # AI配置文件
```

### 2. 字幕文件准备
将字幕文件放入 `srt/` 目录，支持以下格式：
```
srt/
├── E01.srt          # 第1集
├── E02.srt          # 第2集  
├── S01E03.txt       # 第3集
├── 第4集.srt        # 中文命名
└── episode_05.txt   # 英文命名
```

**重要**: 文件会按文件名排序处理，确保文件名能正确反映集数顺序。

### 3. 视频文件准备  
将对应视频文件放入 `videos/` 目录：
```
videos/
├── E01.mp4          # 对应E01.srt
├── E02.mkv          # 对应E02.srt
├── S01E03.avi       # 对应S01E03.txt
├── 第4集.mp4        # 对应第4集.srt
└── episode_05.wmv   # 对应episode_05.txt
```

**支持格式**: .mp4, .mkv, .avi, .mov, .wmv, .flv

## 🚀 快速开始

### 方法1: 点击运行（推荐）
直接点击页面上的 **"Run"** 按钮

### 方法2: 命令行运行
```bash
python main.py
```

## 🤖 AI配置

### 首次使用配置
程序首次运行时会提示配置AI接口：

```
🤖 AI配置向导
==========================================
选择API类型:
1. 官方API (如 Google Gemini)  
2. 代理API (如 OpenRouter, ChatAPI等)
请选择 (1-2): 
```

### 配置选项详解

#### 选项1: 官方API
适用于直接使用官方API的情况：

**Google Gemini示例:**
```
API提供商: gemini
API密钥: [您的Gemini API密钥]
模型名称: gemini-2.5-flash
```

#### 选项2: 代理API  
适用于使用中转服务的情况：

**示例配置:**
```
API地址: https://api.example.com/v1
API密钥: sk-xxxxxxxxxxxx
模型名称: gpt-4
```

### 重新配置
如需重新配置AI，删除 `.ai_config.json` 文件后重新运行即可。

## 📊 处理流程

### 1. 智能分析阶段
- **完整上下文构建**: 整集字幕内容合并分析，避免台词割裂
- **剧情类型识别**: AI自动识别法律剧、爱情剧、悬疑剧等类型
- **精彩片段定位**: 找出3-5个最具戏剧张力的片段
- **时间精确计算**: 确保每个片段2-3分钟，包含完整对话

### 2. 视频剪辑阶段  
- **智能视频匹配**: 自动找到对应的视频文件
- **精确时间剪辑**: 根据AI分析结果剪辑视频片段
- **完整对话保证**: 确保不截断重要句子
- **断点续传**: 已剪辑的片段自动跳过

### 3. 内容生成阶段
- **专业旁白生成**: 为每个片段生成详细解说文件
- **剧情连贯分析**: 分析片段间的逻辑关系
- **总结报告**: 生成完整的剪辑报告

## 📁 输出结果

### 1. 短视频文件
```
clips/
├── 第01集精彩片段1_seg1.mp4
├── 第01集精彩片段2_seg2.mp4  
├── 第02集核心冲突_seg1.mp4
└── ...
```

### 2. 旁白解说文件
每个视频都有对应的旁白文件：
```
clips/
├── 第01集精彩片段1_seg1_旁白.txt
├── 第01集精彩片段2_seg2_旁白.txt
└── ...
```

旁白文件内容包括：
- 片段基本信息（时长、戏剧价值等）
- 专业解说文案（开场、高潮、结尾）
- 关键对话摘录
- 剧情意义分析

### 3. 集数总结文件
```
clips/
├── E01_总结.txt
├── E02_总结.txt  
└── ...
```

### 4. 系统报告
`clips/系统报告.txt` - 包含完整的处理统计和系统特性说明

## 🔧 高级功能

### 1. 智能缓存机制
- AI分析结果自动缓存在 `cache/` 目录
- 相同字幕文件不会重复分析
- 支持增量处理和断点续传

### 2. 一致性保证
- 多次运行相同输入产生相同输出
- 文件名生成规则固定
- 剪辑参数标准化

### 3. 错误修正
- 自动修正常见字幕错误（如"防衛"→"防卫"）
- 支持多种字幕编码格式
- 智能时间格式处理

## 🎯 使用技巧

### 1. 文件命名建议
为确保正确的集数顺序，建议使用以下命名方式：
```
E01.srt, E02.srt, E03.srt...     (推荐)
S01E01.srt, S01E02.srt...        (季集格式)  
01.srt, 02.srt, 03.srt...        (纯数字)
```

### 2. 提升AI分析质量
- 确保字幕文件内容完整
- 尽量使用准确的字幕文件
- 字幕时间轴要准确

### 3. 批量处理
- 可以一次性放入多集字幕和视频
- 系统会按顺序自动处理
- 中途可以暂停，下次运行会从断点继续

## 🔍 问题排查

### 1. AI分析失败
- 检查 `.ai_config.json` 配置是否正确
- 确认API密钥有效性
- 查看是否有网络连接问题

### 2. 视频匹配失败  
- 确保视频文件名与字幕文件名相对应
- 检查视频文件格式是否支持
- 确认videos目录中有对应文件

### 3. 剪辑失败
- 确保安装了FFmpeg
- 检查视频文件是否损坏
- 确认有足够的磁盘空间

## 📈 性能优化

### 1. API调用优化
- 整集分析减少API调用次数
- 智能缓存避免重复分析
- 合理的重试机制

### 2. 处理速度
- 并行处理多个片段
- 断点续传节省时间
- 高效的文件匹配算法

## 🆘 技术支持

如遇到问题，请检查：
1. 文件目录结构是否正确
2. AI配置是否有效
3. 字幕和视频文件是否完整
4. 系统报告中的错误信息

系统设计完全解决了您提出的15个核心问题，提供了完整、智能、高效的电视剧剪辑解决方案。