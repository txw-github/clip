
# 统一电视剧智能剪辑系统 使用教程

## 📋 目录
- [系统简介](#系统简介)
- [快速开始](#快速开始)
- [目录结构](#目录结构)
- [AI配置指南](#ai配置指南)
- [使用流程](#使用流程)
- [常见问题](#常见问题)
- [技术说明](#技术说明)

## 🎬 系统简介

这是一个专为电视剧制作短视频的智能剪辑系统，支持：

- **智能分析**：AI自动识别剧情精彩片段
- **自动剪辑**：基于字幕时间轴自动生成视频片段
- **双重模式**：支持官方API和中转API
- **简洁操作**：一键配置，一键剪辑

## 🚀 快速开始

### 1. 准备文件

将您的文件按以下结构放置：

```
项目目录/
├── srt/          # 放置字幕文件 (.srt 或 .txt)
├── videos/       # 放置视频文件 (.mp4, .mkv, .avi 等)
└── clips/        # 输出目录 (自动创建)
```

### 2. 运行程序

```bash
python main.py
```

### 3. 操作流程

1. 选择 "2. 🤖 配置AI接口" (可选，不配置则使用基础分析)
2. 选择 "1. 🎬 开始智能剪辑"
3. 等待处理完成，在 `clips/` 目录查看结果

## 📁 目录结构

```
项目目录/
├── srt/                    # 字幕文件目录
│   ├── 第01集.srt         # 字幕文件按集数命名
│   ├── 第02集.srt
│   └── ...
├── videos/                 # 视频文件目录
│   ├── 第01集.mp4         # 视频文件与字幕同名
│   ├── 第02集.mp4
│   └── ...
├── clips/                  # 输出目录 (自动生成)
│   ├── 第01集_精彩片段1.mp4
│   ├── 第01集_精彩片段2.mp4
│   └── ...
├── main.py                 # 主程序
└── .ai_config.json        # AI配置文件 (自动生成)
```

### 文件命名规则

- **字幕文件**：支持 `.srt` 和 `.txt` 格式
- **视频文件**：支持 `.mp4`, `.mkv`, `.avi`, `.mov` 等格式
- **命名方式**：字幕和视频文件应同名（扩展名可不同）
- **排序方式**：文件按字符串排序，确保集数顺序正确

示例：
```
srt/第01集.srt  ←→  videos/第01集.mp4
srt/第02集.srt  ←→  videos/第02集.mkv
srt/EP03.srt    ←→  videos/EP03.avi
```

## 🤖 AI配置指南

### 官方API配置

#### Google Gemini (推荐)
```
1. 访问 https://aistudio.google.com/
2. 获取API密钥
3. 在程序中选择 "1. 官方API" → "1. Google Gemini"
4. 输入API密钥
```

#### OpenAI
```
1. 访问 https://platform.openai.com/
2. 获取API密钥
3. 在程序中选择 "1. 官方API" → "2. OpenAI"
4. 输入API密钥
```

### 中转API配置

#### 推荐的中转服务商

1. **ChatAI API** (推荐)
   - 地址：`https://www.chataiapi.com/v1`
   - 支持模型：`deepseek-r1`, `claude-3.5-sonnet`, `gpt-4o`
   - 特点：稳定快速，支持多种模型

2. **OpenRouter**
   - 地址：`https://openrouter.ai/api/v1`
   - 支持模型：`deepseek/deepseek-r1`, `google/gemini-2.0-flash`
   - 特点：有免费模型可用

3. **算力云**
   - 地址：`https://api.suanli.cn/v1`
   - 支持模型：`deepseek-ai/DeepSeek-R1`, `Qwen/Qwen2.5-72B`
   - 特点：价格便宜

#### 配置步骤
```
1. 在程序中选择 "2. 中转API"
2. 输入API地址 (如: https://www.chataiapi.com/v1)
3. 输入API密钥
4. 输入模型名称 (如: deepseek-r1)
```

## 📖 使用流程

### 步骤1：准备材料

1. **字幕文件**：
   - 格式：标准SRT格式或纯文本
   - 编码：支持UTF-8、GBK等
   - 命名：按集数顺序命名

2. **视频文件**：
   - 格式：MP4、MKV、AVI等主流格式
   - 命名：与字幕文件同名
   - 质量：建议1080p或以上

### 步骤2：配置系统

1. 运行 `python main.py`
2. 选择 "2. 🤖 配置AI接口"
3. 根据网络环境选择官方API或中转API
4. 输入相应的API密钥和配置信息

### 步骤3：开始剪辑

1. 选择 "1. 🎬 开始智能剪辑"
2. 系统自动处理所有字幕文件
3. 每集生成2-3个精彩片段
4. 处理完成后在 `clips/` 目录查看结果

### 步骤4：查看结果

生成的文件包括：
- `*.mp4`：剪辑好的视频片段
- 自动按集数和片段编号命名
- 时长通常为2-3分钟

## ❓ 常见问题

### Q1: 没有AI配置可以使用吗？
**A:** 可以！系统会使用基础关键词分析，虽然效果不如AI但仍能识别精彩片段。

### Q2: 字幕和视频文件名不完全一致怎么办？
**A:** 系统支持模糊匹配，只要文件名包含相同的关键部分即可自动匹配。

### Q3: 支持哪些视频格式？
**A:** 支持MP4、MKV、AVI、MOV、WMV、FLV等主流格式。

### Q4: 生成的片段可以自定义时长吗？
**A:** 目前系统自动控制在2-3分钟，确保包含完整对话内容。

### Q5: 如何提高剪辑质量？
**A:** 
1. 配置AI接口（大幅提升分析准确度）
2. 确保字幕文件质量和格式正确
3. 使用高质量的原始视频文件

### Q6: API调用失败怎么办？
**A:**
1. 检查网络连接
2. 验证API密钥是否正确
3. 官方API需要魔法上网
4. 可以尝试中转API服务

### Q7: 处理大量集数会很慢吗？
**A:** 系统会按顺序处理，每集大约需要1-3分钟（取决于视频长度和网络速度）。

## 🔧 技术说明

### 系统架构

```
输入层：字幕文件 + 视频文件
  ↓
解析层：字幕解析 + 编码处理
  ↓
分析层：AI分析 / 基础关键词分析
  ↓
匹配层：智能文件匹配
  ↓
剪辑层：FFmpeg自动剪辑
  ↓
输出层：生成精彩片段
```

### 核心功能

1. **智能字幕解析**
   - 支持多种编码格式
   - 自动纠正时间格式
   - 智能文本清理

2. **AI剧情分析**
   - 上下文理解
   - 戏剧冲突识别
   - 精彩度评分

3. **基础关键词分析**
   - 情感关键词识别
   - 标点符号分析
   - 剧情张力评估

4. **智能文件匹配**
   - 精确匹配优先
   - 模糊匹配备选
   - 自动格式识别

5. **自动视频剪辑**
   - FFmpeg高质量剪辑
   - 时间精确控制
   - 格式自动转换

### 依赖库

- `requests`：API调用
- `google-genai`：Gemini官方API (可选)
- `openai`：OpenAI兼容API (可选)
- `ffmpeg`：视频剪辑 (需要系统安装)

### 配置文件

`.ai_config.json` 示例：
```json
{
  "enabled": true,
  "api_type": "official",
  "provider": "gemini",
  "api_key": "your-api-key",
  "model": "gemini-2.5-flash"
}
```

## 📝 版本信息

- **当前版本**：2.0
- **更新内容**：
  - 重构API调用逻辑
  - 简化配置流程
  - 优化文件匹配
  - 提升剪辑稳定性

## 📞 技术支持

如遇到问题：
1. 检查文件目录结构是否正确
2. 确认字幕和视频文件格式
3. 验证AI配置是否有效
4. 查看程序输出的错误信息

祝您使用愉快！🎉
# 📺 电视剧智能剪辑系统 - 详细使用教程

## 🎯 系统简介

这是一个基于AI大模型的电视剧智能分析和视频剪辑系统，能够：

- 🤖 **AI智能分析**: 支持官方API和中转API，智能识别剧情精彩片段
- 🎬 **自动剪辑**: 基于AI分析结果进行视频片段剪切
- 📝 **专业旁白**: 生成专业的剧情解说和分析报告
- 💾 **智能缓存**: 避免重复分析，提高效率

## 🚀 快速开始

### 第一步：准备文件

创建以下目录结构：

```
项目目录/
├── srt/              # 字幕文件目录
│   ├── 第01集.srt    # 字幕文件（按集数命名）
│   ├── 第02集.srt
│   └── ...
├── videos/           # 视频文件目录
│   ├── 第01集.mp4    # 对应的视频文件
│   ├── 第02集.mp4
│   └── ...
└── clips/            # 输出目录（自动创建）
```

### 第二步：运行系统

```bash
python main.py
```

### 第三步：配置AI（可选）

在主菜单中选择 `1. 🤖 配置AI接口`，然后选择合适的AI服务：

1. **DeepSeek 官方** - 性价比高，推荐
2. **Gemini 官方** - Google官方API
3. **DeepSeek 中转** - 通过中转商访问
4. **Claude 中转** - 效果优秀
5. **GPT-4o 中转** - OpenAI最新模型

### 第四步：开始剪辑

选择 `2. 🎬 开始智能剪辑`，系统将自动处理所有字幕文件。

## 🤖 AI配置详解

### 官方API配置

#### 1. DeepSeek 官方
```
API类型: 官方（无base_url）
获取密钥: https://platform.deepseek.com
模型: deepseek-r1
特点: 具有思考链，分析详细，性价比高
```

#### 2. Gemini 官方
```
API类型: 官方（无base_url）
获取密钥: https://aistudio.google.com/app/apikey
模型: gemini-2.5-flash
特点: Google官方，速度快，免费额度大
```

### 中转API配置

#### 3. 中转商推荐
```
推荐中转商: https://www.chataiapi.com
支持模型: deepseek-r1, claude-3-5-sonnet-20240620, gpt-4o
特点: 稳定可靠，支持多种模型
```

## 📁 文件格式要求

### 字幕文件格式

支持 `.srt` 和 `.txt` 格式，标准SRT格式：

```
1
00:00:15,230 --> 00:00:18,660
我要为四二八案申请重审

2
00:00:19,440 --> 00:00:22,320
这个证据证明当年的判决有误
```

### 视频文件格式

支持常见视频格式：
- `.mp4` (推荐)
- `.mkv`
- `.avi`
- `.mov`
- `.wmv`
- `.flv`

### 文件命名规则

**重要**: 字幕文件名将作为集数标识，按字符串排序决定播放顺序。

推荐命名方式：
```
第01集.srt / 第01集.mp4
第02集.srt / 第02集.mp4
S01E01.srt / S01E01.mp4
EP01.srt / EP01.mp4
```

## 🎬 剪辑流程详解

### 1. 字幕解析
- 自动检测文件编码（UTF-8, GBK, UTF-16）
- 解析时间轴和对话内容
- 智能纠错常见错别字

### 2. AI智能分析
- 分析前80%内容（避免剧透）
- 识别3-5个最精彩片段
- 每个片段2-3分钟
- 生成专业旁白解说

### 3. 视频剪辑
- 智能匹配视频文件
- 使用FFmpeg进行精确剪辑
- 添加缓冲时间确保对话完整
- 自动优化视频质量

### 4. 输出文件
```
clips/
├── 精彩片段1_seg1.mp4        # 剪辑的视频片段
├── 精彩片段1_seg1_旁白解说.txt # 对应的旁白解说
├── 精彩片段2_seg2.mp4
├── 精彩片段2_seg2_旁白解说.txt
└── ...
```

## 🔧 系统要求

### Python环境
- Python 3.7 或更高版本
- 自动安装依赖：`openai`, `google-genai`

### FFmpeg (用于视频剪辑)
```bash
# Ubuntu/Debian
sudo apt update && sudo apt install ffmpeg

# macOS
brew install ffmpeg

# Windows
下载安装包: https://ffmpeg.org/download.html
```

## 💾 缓存机制

### 分析缓存
- 自动缓存AI分析结果
- 避免重复调用API
- 基于字幕内容生成缓存键
- 手动清理：选择菜单 `5. 🔄 清空分析缓存`

### 视频剪辑缓存
- 已存在的视频片段不会重复剪辑
- 支持增量处理
- 安全文件名处理

## 🎯 AI分析提示词

系统使用专业的提示词模板：

```
# 电视剧智能分析与精彩剪辑

请为第XX集进行智能分析。

## 分析要求
1. 智能识别3-5个最精彩的片段
2. 每个片段2-3分钟，包含完整对话
3. 确保片段间逻辑连贯
4. 生成专业旁白解说

## 输出格式
JSON格式，包含：
- episode_analysis: 集数分析
- highlight_segments: 精彩片段列表
```

## 🔍 常见问题

### Q1: AI分析失败怎么办？
- 检查API密钥是否正确
- 确认网络连接正常
- 查看是否有API额度
- 尝试重新配置AI接口

### Q2: 找不到视频文件？
- 确保视频文件放在 `videos/` 目录
- 检查文件名是否与字幕文件匹配
- 支持模糊匹配，但建议文件名一致

### Q3: FFmpeg未安装？
- 系统会提示安装FFmpeg
- 没有FFmpeg只能进行AI分析，无法剪辑视频
- 按系统类型安装FFmpeg

### Q4: 字幕文件乱码？
- 系统自动尝试多种编码
- 推荐使用UTF-8编码
- 检查字幕文件格式是否正确

### Q5: 如何提高分析质量？
- 选择更强的AI模型（如Claude、GPT-4o）
- 确保字幕内容完整准确
- 合理命名文件，便于识别集数

## 🎨 高级使用技巧

### 1. 批量处理
- 系统自动按文件名排序处理所有集数
- 支持断点续传，已处理的不会重复

### 2. 自定义剪辑
- 修改AI分析结果中的时间点
- 手动调整片段时长
- 编辑旁白解说内容

### 3. 质量优化
- 使用高质量的字幕文件
- 确保视频文件清晰度
- 选择合适的AI模型

## 📊 性能优化

### API调用优化
- 智能缓存避免重复调用
- 批量处理减少网络开销
- 合理控制分析内容长度

### 视频处理优化
- 使用H.264编码保证兼容性
- 合理的CRF值平衡质量和大小
- 快速启动标志提高播放体验

## 🛠️ 故障排除

### 1. 权限问题
```bash
chmod +x main.py
```

### 2. 依赖安装失败
```bash
pip install --upgrade pip
pip install openai google-genai
```

### 3. 编码问题
- 将字幕文件转换为UTF-8编码
- 检查文件是否损坏

### 4. 网络问题
- 检查防火墙设置
- 尝试使用VPN（如访问官方API）
- 使用中转API提高稳定性

## 📝 版本更新

### v1.0 特性
- ✅ 官方API和中转API支持
- ✅ 智能字幕解析
- ✅ AI剧情分析
- ✅ 自动视频剪辑
- ✅ 专业旁白生成
- ✅ 智能缓存机制

### 未来计划
- 🔄 支持更多AI模型
- 🎨 可视化界面
- 📱 移动端支持
- 🌐 Web界面版本

## 💡 使用建议

1. **首次使用**: 先配置AI接口，然后用1-2集测试
2. **批量处理**: 确认配置正确后再处理所有集数
3. **质量控制**: 定期检查生成的片段质量
4. **备份重要**: 保留原始字幕和视频文件
5. **合理使用**: 遵守AI服务商的使用条款

## 🔗 相关链接

- **DeepSeek官网**: https://platform.deepseek.com
- **Google AI Studio**: https://aistudio.google.com
- **ChatAI API**: https://www.chataiapi.com
- **FFmpeg官网**: https://ffmpeg.org
- **项目文档**: 本README文件

---

🎬 **祝您使用愉快！如有问题，请参考故障排除部分或重新阅读相关章节。**
