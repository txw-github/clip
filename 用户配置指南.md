
# 🎬 电影AI剪辑系统 - 用户配置指南

## 🚀 快速开始（引导式配置）

### 第一步：检查系统要求
1. **Python环境**：确保已安装Python 3.8+
2. **FFmpeg**：用于视频剪辑（系统会自动检查）
3. **AI API密钥**：需要配置AI接口进行分析

### 第二步：准备文件
```
项目目录/
├── movie_srt/              # 电影字幕文件目录
│   ├── 复仇者联盟.srt
│   ├── 阿凡达.txt
│   └── ...
├── movie_videos/           # 电影视频文件目录（可选）
│   ├── 复仇者联盟.mp4
│   ├── 阿凡达.mkv
│   └── ...
└── movie_clips/            # 输出目录（自动创建）
```

### 第三步：AI配置选择

#### 选项1：官方API（推荐）
**Google Gemini配置：**
```json
{
  "enabled": true,
  "api_type": "official",
  "provider": "gemini",
  "api_key": "你的Gemini API密钥",
  "model": "gemini-2.0-flash-exp"
}
```

**获取Gemini API密钥：**
1. 访问 [Google AI Studio](https://aistudio.google.com/)
2. 登录Google账号
3. 创建API密钥
4. 复制密钥到配置中

#### 选项2：中转API
**配置示例：**
```json
{
  "enabled": true,
  "api_type": "proxy",
  "provider": "proxy",
  "base_url": "https://www.chataiapi.com/v1",
  "api_key": "sk-xxxxxxxxxxxxxxxx",
  "model": "deepseek-r1"
}
```

**推荐中转服务：**
- ChatAI: https://www.chataiapi.com/
- OpenRouter: https://openrouter.ai/
- 其他OpenAI兼容API

### 第四步：运行系统
```bash
python movie_ai_clipper.py
```

## 🎯 核心功能说明

### 问题9解决：第一人称精确同步
- **视频与叙述实时对应**：每个时间点的视频内容都有对应的第一人称叙述
- **智能分段叙述**：开场、发展、高潮、结尾四个阶段精确同步
- **毫秒级时间匹配**：确保叙述文本与视频画面完美对应

### 问题10解决：API结果缓存
- **智能缓存机制**：AI分析结果自动保存，避免重复API调用
- **断点续传**：如果分析中断，下次运行会继续处理
- **缓存验证**：确保缓存数据完整性和有效性

### 问题11解决：剪辑一致性
- **一致性保证**：相同的分析结果多次剪辑得到相同视频
- **校验机制**：每个剪辑都有唯一标识，确保结果一致
- **重试机制**：剪辑失败时自动重试，保证成功率

### 问题12解决：避免重复剪辑
- **剪辑状态跟踪**：已完成的剪辑不会重复执行
- **智能跳过**：检测到已存在的视频文件会跳过剪辑
- **状态恢复**：支持中断后继续剪辑未完成的片段

### 问题13解决：执行一致性
- **哈希验证**：基于文件内容生成唯一标识
- **多次执行保证**：相同输入得到相同输出
- **缓存机制**：避免重复计算和处理

### 问题14解决：批量处理
- **全文件扫描**：处理movie_srt目录下所有字幕文件
- **智能过滤**：已处理的文件使用缓存结果
- **进度跟踪**：显示整体处理进度和状态

### 问题15解决：引导式配置
- **交互式设置**：友好的配置界面
- **自动检测**：检查现有配置并提供建议
- **一键配置**：简化配置流程

## 📊 输出文件详解

### 视频文件
```
movie_clips/
├── 复仇者联盟_片段01_关键冲突.mp4           # 无声视频
├── 复仇者联盟_片段01_关键冲突_第一人称叙述.srt # 叙述字幕
├── 复仇者联盟_片段01_关键冲突_叙述详情.txt   # 详细说明
└── ...
```

### 分析文件
```
movie_analysis/
├── 复仇者联盟_AI剪辑方案.txt    # 完整剪辑方案
├── 复仇者联盟_AI分析数据.json   # 原始分析数据
└── 电影AI分析总结报告.txt        # 总结报告
```

### 缓存文件
```
ai_cache/
├── analysis_复仇者联盟_abc123.json     # AI分析缓存
├── analysis_复仇者联盟_abc123_temp.json # 临时分析文件
└── ...
```

## 🔧 常见问题解决

### Q1：AI配置失败
**解决方案：**
1. 检查API密钥是否正确
2. 确认网络连接正常
3. 尝试不同的API提供商

### Q2：视频剪辑失败
**解决方案：**
1. 确保安装了FFmpeg
2. 检查视频文件格式是否支持
3. 确认有足够的磁盘空间

### Q3：字幕文件解析失败
**解决方案：**
1. 检查字幕文件编码（支持UTF-8、GBK等）
2. 确认字幕格式正确（SRT或TXT）
3. 查看是否有特殊字符

### Q4：第一人称叙述不同步
**解决方案：**
1. 检查AI分析结果的时间标记
2. 确认视频文件与字幕文件匹配
3. 重新生成叙述字幕文件

## 💡 使用技巧

### 1. 提升AI分析质量
- 使用高质量的字幕文件
- 确保字幕内容完整准确
- 选择合适的AI模型

### 2. 优化剪辑效果
- 保持视频文件高质量
- 确保字幕时间戳准确
- 定期清理缓存文件

### 3. 批量处理建议
- 按电影类型分批处理
- 监控磁盘空间使用
- 定期备份重要结果

## 📞 技术支持

如果遇到问题，请检查：
1. 系统日志输出
2. 错误信息详情
3. 配置文件内容
4. 网络连接状态

系统会自动生成详细的处理报告，帮助诊断和解决问题。
